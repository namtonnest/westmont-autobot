<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toronto Auto Sales | Inventory Bot</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #e74c3c; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* Header */
        header { background: var(--primary); color: white; padding: 1rem; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        /* Chat Area */
        #chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .message { max-width: 80%; padding: 12px 16px; border-radius: 15px; line-height: 1.4; }
        .bot { background: white; align-self: flex-start; border: 1px solid #ddd; color: #333; }
        .user { background: var(--primary); color: white; align-self: flex-end; }
        
        /* Input Area */
        .input-area { background: white; padding: 20px; display: flex; gap: 10px; border-top: 1px solid #ddd; }
        input { flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 5px; outline: none; }
        button { background: var(--secondary); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        /* Car Card styling for the Bot */
        .car-card { border-left: 4px solid var(--secondary); margin-top: 10px; padding-left: 10px; font-size: 0.9em; }
    </style>
</head>
<body>

<header>
    <h1>Toronto Auto Sales</h1>
    <p>Inventory Assistant v1.0</p>
</header>

<div id="chat-container">
    <div class="message bot">
        Hello! I'm your <strong>Smart AI Assistant</strong> for Toronto Auto Sales. We have <strong>30 quality vehicles</strong>!<br><br>
        üß† <strong>I understand natural language! Try:</strong><br>
        ‚Ä¢ "Cheap Audi SUVs"<br>
        ‚Ä¢ "2018 Nissan under $17k"<br>
        ‚Ä¢ "Luxury vehicles 2019 or newer"<br>
        ‚Ä¢ "Low mileage hybrids"<br>
        ‚Ä¢ "Best value cars"<br>
        ‚Ä¢ "Recommend something" or "Compare" (after search)<br><br>
        <em>What can I help you find today?</em> üöó
    </div>
</div>

<div class="input-area">
    <input type="text" id="userInput" placeholder="Type your question here..." onkeypress="handleKey(event)">
    <button onclick="sendMessage()">Send</button>
</div>

<script>
    const inventory = [
        { year: 2018, make: "Audi", model: "Q7", type: "SUV", price: 21900, km: 160000, exterior: "White", interior: "Black", fuel: "Gasoline", highlights: "Clean Carfax, One Owner, Panoramic Sunroof" },
        { year: 2015, make: "Audi", model: "Q3", type: "SUV", price: 12900, km: 150000, exterior: "Grey", interior: "Black", fuel: "Gasoline", highlights: "Clean Carfax, LED Headlights" },
        { year: 2016, make: "Nissan", model: "Rogue", type: "SUV", price: 11900, km: 127000, exterior: "Red", interior: "Black", fuel: "Gasoline", highlights: "SL Trim, Navigation" },
        { year: 2015, make: "Hyundai", model: "Santa Fe Sport", type: "SUV", price: 12900, km: 160000, exterior: "White", interior: "Black", fuel: "Gasoline", highlights: "Panoramic Sunroof, Navigation" },
        { year: 2018, make: "Hyundai", model: "Santa Fe Sport", type: "SUV", price: 14900, km: 160000, exterior: "White", interior: "Black", fuel: "Gasoline", highlights: "Clean Title, Panoramic Sunroof" },
        { year: 2018, make: "Mitsubishi", model: "Outlander PHEV", type: "SUV", price: 16900, km: 138000, exterior: "Black", interior: "Black", fuel: "Hybrid", highlights: "Plug-in Hybrid, Panoramic Sunroof" },
        { year: 2020, make: "Nissan", model: "Rogue", type: "SUV", price: 16500, km: 140000, exterior: "White", interior: "Black", fuel: "Gasoline", highlights: "Clean Carfax, Panoramic Sunroof" },
        { year: 2017, make: "BMW", model: "X6", type: "SUV", price: 21500, km: 160000, exterior: "Grey", interior: "Brown", fuel: "Gasoline", highlights: "M-Sport, Panoramic Sunroof" },
        { year: 2020, make: "Nissan", model: "Rogue", type: "SUV", price: 15500, km: 120000, exterior: "Black", interior: "Black", fuel: "Gasoline", highlights: "Low KM, Panoramic Sunroof" },
        { year: 2018, make: "Jaguar", model: "F-Pace", type: "SUV", price: 17900, km: 140000, exterior: "Grey", interior: "Black", fuel: "Diesel", highlights: "20D, Clean Carfax, Panoramic Sunroof" },
        { year: 2020, make: "Ford", model: "Edge", type: "SUV", price: 17500, km: 160000, exterior: "Black", interior: "Off White", fuel: "Gasoline", highlights: "Titanium, Clean Carfax, Panoramic Sunroof" },
        { year: 2016, make: "Audi", model: "A4", type: "Sedan", price: 11900, km: 150000, exterior: "Black", interior: "Black", fuel: "Gasoline", highlights: "TFSI S-Line, One Owner, Panoramic Sunroof" },
        { year: 2017, make: "Porsche", model: "Macan", type: "SUV", price: 18500, km: 180000, exterior: "Grey", interior: "Black", fuel: "Gasoline", highlights: "Panoramic Sunroof, LED Headlights" },
        { year: 2017, make: "Hyundai", model: "Elantra", type: "Sedan", price: 8900, km: 150000, exterior: "White", interior: "Black", fuel: "Gasoline", highlights: "Panoramic Sunroof, Affordable" },
        { year: 2015, make: "Audi", model: "A4", type: "Sedan", price: 11900, km: 150000, exterior: "Black", interior: "Tan", fuel: "Gasoline", highlights: "TFSI S-Line, Panoramic Sunroof" },
        { year: 2017, make: "Audi", model: "Q3", type: "SUV", price: 17500, km: 124000, exterior: "White", interior: "Black", fuel: "Gasoline", highlights: "Clean Carfax, Low KM, Panoramic Sunroof" },
        { year: 2018, make: "Audi", model: "Q5", type: "SUV", price: 16900, km: 150000, exterior: "White", interior: "Black", fuel: "Gasoline", highlights: "Clean Carfax, Panoramic Sunroof" },
        { year: 2018, make: "Infiniti", model: "QX60", type: "SUV", price: 17500, km: 140000, exterior: "White", interior: "Black", fuel: "Gasoline", highlights: "Clean Carfax, Luxury 7-Seater" },
        { year: 2015, make: "Hyundai", model: "Santa Fe Sport", type: "SUV", price: 12900, km: 150000, exterior: "Orange", interior: "Black", fuel: "Gasoline", highlights: "Limited, Cooled/Heated Seats, Panoramic Sunroof" },
        { year: 2019, make: "Ford", model: "Edge", type: "SUV", price: 15500, km: 150000, exterior: "Blue", interior: "Black", fuel: "Gasoline", highlights: "SEL, Panoramic Sunroof" },
        { year: 2018, make: "Nissan", model: "Pathfinder", type: "SUV", price: 16500, km: 160000, exterior: "Grey", interior: "Black", fuel: "Gasoline", highlights: "Platinum, Clean Carfax, 7-Seater" },
        { year: 2016, make: "Mazda", model: "CX-3", type: "SUV", price: 12900, km: 190000, exterior: "Black", interior: "Black", fuel: "Gasoline", highlights: "Clean Carfax, Panoramic Sunroof" },
        { year: 2017, make: "Infiniti", model: "QX60", type: "SUV", price: 17500, km: 113000, exterior: "White", interior: "Brown", fuel: "Gasoline", highlights: "Clean Carfax, One Owner, Low KM" },
        { year: 2017, make: "Hyundai", model: "Tucson", type: "SUV", price: 14900, km: 101000, exterior: "White", interior: "Black", fuel: "Gasoline", highlights: "Clean Carfax, Low KM, Panoramic Sunroof" },
        { year: 2019, make: "Land Rover", model: "Range Rover Sport", type: "SUV", price: 42500, km: 100000, exterior: "Black", interior: "Black", fuel: "Gasoline", highlights: "Clean Carfax, One Owner, Cooled/Heated Seats" },
        { year: 2017, make: "Hyundai", model: "Tucson", type: "SUV", price: 10900, km: 159850, exterior: "Grey", interior: "Off White", fuel: "Gasoline", highlights: "Clean Carfax, One Owner, Cooled/Heated Seats" },
        { year: 2017, make: "Hyundai", model: "Elantra", type: "Sedan", price: 9950, km: 150000, exterior: "White", interior: "Black", fuel: "Gasoline", highlights: "Great Value" },
        { year: 2019, make: "Porsche", model: "Panamera", type: "Sedan", price: 43900, km: 160000, exterior: "Blue", interior: "Tan", fuel: "Gasoline", highlights: "Panamera 4, Panoramic Sunroof" },
        { year: 2018, make: "Nissan", model: "Pathfinder", type: "SUV", price: 12900, km: 160000, exterior: "Black", interior: "Black", fuel: "Gasoline", highlights: "SV, 7-Seater, Navigation" },
        { year: 2018, make: "Audi", model: "Q5", type: "SUV", price: 16500, km: 170000, exterior: "White", interior: "Black", fuel: "Gasoline", highlights: "Panoramic Sunroof, LED Headlights" }
    ];

    let conversationContext = { lastResults: [], userPreferences: {} };

    function handleKey(e) { if (e.keyCode === 13) sendMessage(); }

    function sendMessage() {
        const input = document.getElementById('userInput');
        const text = input.value.trim();
        if (!text) return;

        addMessage(text, 'user');
        input.value = '';
        
        setTimeout(() => processQuery(text), 500);
    }

    // Extract numbers from query for prices and years
    function extractNumbers(text) {
        const matches = text.match(/\d+/g);
        return matches ? matches.map(Number) : [];
    }

    // Extract year range from query
    function extractYearRange(q) {
        const numbers = extractNumbers(q);
        if (q.includes("newer") || q.includes("latest") || q.includes("recent")) {
            const year = numbers.length > 0 ? numbers[0] : 2018;
            return { min: year, max: 2025 };
        }
        if (q.includes("older") || q.includes("before")) {
            const year = numbers.length > 0 ? numbers[0] : 2017;
            return { min: 2010, max: year };
        }
        if (numbers.length >= 2 && numbers[0] > 2000 && numbers[1] > 2000) {
            return { min: Math.min(numbers[0], numbers[1]), max: Math.max(numbers[0], numbers[1]) };
        }
        return null;
    }

    // Extract price from query
    function extractPrice(q) {
        const numbers = extractNumbers(q);
        // Look for price indicators
        if (q.includes("under") || q.includes("below") || q.includes("less than")) {
            const price = numbers.find(n => n > 1000) || 15000;
            return { max: price * (price < 100 ? 1000 : 1) };
        }
        if (q.includes("over") || q.includes("above") || q.includes("more than")) {
            const price = numbers.find(n => n > 1000) || 20000;
            return { min: price * (price < 100 ? 1000 : 1) };
        }
        if (q.includes("between")) {
            const prices = numbers.filter(n => n > 1000);
            if (prices.length >= 2) {
                return { min: Math.min(prices[0], prices[1]) * (prices[0] < 100 ? 1000 : 1), 
                        max: Math.max(prices[0], prices[1]) * (prices[1] < 100 ? 1000 : 1) };
            }
        }
        return null;
    }

    // Extract make from query
    function extractMake(q) {
        const makes = ["audi", "bmw", "porsche", "nissan", "hyundai", "ford", "infiniti", "jaguar", "land rover", "mazda", "mitsubishi"];
        return makes.find(make => q.includes(make));
    }

    // Extract type from query
    function extractType(q) {
        if (q.includes("suv") || q.includes("crossover")) return "SUV";
        if (q.includes("sedan") || q.includes("car")) return "Sedan";
        return null;
    }

    function addMessage(text, sender) {
        const container = document.getElementById('chat-container');
        const msgDiv = document.createElement('div');
        msgDiv.className = `message ${sender}`;
        msgDiv.innerHTML = text;
        container.appendChild(msgDiv);
        container.scrollTop = container.scrollHeight;
    }

    function processQuery(query) {
        const q = query.toLowerCase();
        let results = [...inventory];
        let response = "";
        let filterApplied = false;

        // SMART MULTI-CRITERIA FILTERING
        
        // 1. Filter by Make
        const make = extractMake(q);
        if (make) {
            results = results.filter(c => c.make.toLowerCase() === make);
            response += `${make.charAt(0).toUpperCase() + make.slice(1)} `;
            filterApplied = true;
        }

        // 2. Filter by Type
        const type = extractType(q);
        if (type) {
            results = results.filter(c => c.type === type);
            response += `${type}s `;
            filterApplied = true;
        }

        // 3. Filter by Price Range
        const priceRange = extractPrice(q);
        if (priceRange) {
            if (priceRange.min) results = results.filter(c => c.price >= priceRange.min);
            if (priceRange.max) results = results.filter(c => c.price <= priceRange.max);
            if (priceRange.max) response += `under $${(priceRange.max/1000).toFixed(0)}k `;
            if (priceRange.min) response += `over $${(priceRange.min/1000).toFixed(0)}k `;
            filterApplied = true;
        }

        // 4. Filter by Year Range
        const yearRange = extractYearRange(q);
        if (yearRange) {
            results = results.filter(c => c.year >= yearRange.min && c.year <= yearRange.max);
            if (yearRange.min === yearRange.max) {
                response += `from ${yearRange.min} `;
            } else {
                response += `${yearRange.min}-${yearRange.max} `;
            }
            filterApplied = true;
        }

        // 5. Special filters
        if (q.includes("hybrid") || q.includes("electric")) {
            results = results.filter(c => c.fuel === "Hybrid");
            response += "Hybrid ";
            filterApplied = true;
        }
        if (q.includes("diesel")) {
            results = results.filter(c => c.fuel === "Diesel");
            response += "Diesel ";
            filterApplied = true;
        }
        if (q.includes("low km") || q.includes("low mileage")) {
            results = results.filter(c => c.km < 120000);
            response += "Low Mileage ";
            filterApplied = true;
        }
        if (q.includes("white") && !q.includes("off white")) {
            results = results.filter(c => c.exterior === "White");
            response += "White ";
            filterApplied = true;
        }
        if (q.includes("black")) {
            results = results.filter(c => c.exterior === "Black");
            response += "Black ";
            filterApplied = true;
        }

        // SMART SORTING
        if (q.includes("cheapest") || q.includes("affordable") || q.includes("budget")) {
            results.sort((a,b) => a.price - b.price);
            results = results.slice(0, 5);
            response = "Most Affordable " + response;
        } else if (q.includes("expensive") || q.includes("luxury") || q.includes("premium")) {
            results.sort((a,b) => b.price - a.price);
            results = results.slice(0, 5);
            response = "Premium " + response;
        } else if (q.includes("newest") || q.includes("latest")) {
            results.sort((a,b) => b.year - a.year);
            results = results.slice(0, 5);
            response = "Newest " + response;
        } else if (q.includes("best value")) {
            results.sort((a,b) => (a.price/a.year) - (b.price/b.year));
            results = results.slice(0, 5);
            response = "Best Value " + response;
        } else {
            // Default sort by year (newest first)
            results.sort((a,b) => b.year - a.year);
        }

        // SPECIAL QUERIES
        if (q.includes("count") || q.includes("how many")) {
            let countMsg = `We have <strong>${results.length} vehicle${results.length !== 1 ? 's' : ''}</strong>`;
            if (filterApplied) countMsg += " matching your criteria!";
            else countMsg += " in total inventory.";
            addMessage(countMsg, 'bot');
            return;
        }

        if (q.includes("compare") && conversationContext.lastResults.length >= 2) {
            const car1 = conversationContext.lastResults[0];
            const car2 = conversationContext.lastResults[1];
            const comparison = `
                <div class="car-card">
                    <strong>Comparison:</strong><br><br>
                    <strong>${car1.year} ${car1.make} ${car1.model}</strong> vs <strong>${car2.year} ${car2.make} ${car2.model}</strong><br><br>
                    üí∞ Price: $${car1.price.toLocaleString()} vs $${car2.price.toLocaleString()} 
                    (${car1.price < car2.price ? '‚úÖ Cheaper' : '‚ùå More expensive'})<br>
                    üìè Mileage: ${car1.km.toLocaleString()} km vs ${car2.km.toLocaleString()} km 
                    (${car1.km < car2.km ? '‚úÖ Lower' : '‚ùå Higher'})<br>
                    üìÖ Year: ${car1.year} vs ${car2.year} 
                    (${car1.year > car2.year ? '‚úÖ Newer' : car1.year === car2.year ? '‚öñÔ∏è Same' : '‚ùå Older'})<br>
                    ‚õΩ Fuel: ${car1.fuel} vs ${car2.fuel}<br>
                </div>
            `;
            addMessage(comparison, 'bot');
            return;
        }

        if (q.includes("recommend") || q.includes("suggest")) {
            results.sort((a,b) => {
                const scoreA = (2025 - a.year) * 100 + a.price/100 + a.km/1000;
                const scoreB = (2025 - b.year) * 100 + b.price/100 + b.km/1000;
                return scoreA - scoreB;
            });
            results = results.slice(0, 3);
            response = "üåü Top Recommendations for You:";
        }

        // Build response message
        if (!filterApplied && !response) {
            response = "I can help you find the perfect vehicle! Try:<br>‚Ä¢ \"Cheap Audi SUVs\"<br>‚Ä¢ \"2020 Nissan under $17k\"<br>‚Ä¢ \"Luxury vehicles\"<br>‚Ä¢ \"Low mileage hybrids\"<br><br>Showing all inventory:";
        } else if (filterApplied) {
            response = "Found " + response + "vehicles:";
        }

        // Store results for context
        conversationContext.lastResults = results;

        // Display results
        let carListHtml = response;
        results.forEach(car => {
            carListHtml += `<div class="car-card">
                <strong>${car.year} ${car.make} ${car.model}</strong><br>
                Price: <strong>$${car.price.toLocaleString()}</strong> | ${car.km.toLocaleString()} km<br>
                ${car.exterior} exterior, ${car.interior} interior | ${car.fuel}<br>
                <em>${car.highlights}</em>
            </div>`;
        });

        if (results.length === 0) {
            carListHtml = "‚ùå Sorry, no vehicles match those criteria. Try:<br>‚Ä¢ Broader search terms<br>‚Ä¢ Different price range<br>‚Ä¢ \"Show all vehicles\"";
        } else if (results.length > 1) {
            carListHtml += "<br><small>üí° Tip: Ask \"compare\" to compare the first two results!</small>";
        }

        carListHtml += "<br><small>*Price excludes $799 certification & applicable taxes.</small>";
        addMessage(carListHtml, 'bot');
    }
</script>

</body>
</html>